{% load static %}
<div class="container-fluid email-wrap bookmark-wrap todo-wrap">
    <div class="row flex-row">

      {% include 'components/diary_sidebar.html' %}

      <div class="col-xl-9 xl-70 box-col-12">
        <div class="card">
          <div class="card-header">
                <div class="col-4"><h4>Форма мероприятия (Детская)</h4></div>
            </div>
            <div class="card-body">
                <form method="post" id="ChildBookReportForm" class="theme-form">
                    {% csrf_token %}
                    <div class="modal-body">

                        <!-- Группа регистрации -->
                        <fieldset>
                            <legend></legend>
                            <div class="row mb-3 g-3">
                                <div class="col-md-3">
                                    <label for="id_cafedra" class="form-label">Кафедра</label>
                                    {{ form.cafedra }}
                                </div>
                                <div class="col-md-3">
                                    <label for="id_date" class="form-label">Дата отчета</label>
                                    {{ form.date }}
                                </div>
                            </div>
                        </fieldset>

                        <!-- Группа книговыдачи -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <fieldset class="border border-2 border-warning p-4 mb-1">
                                    <legend class="text-warning">Книговыдача</legend>
                                        {% if mod_lib %}
                                            <span class="float-end text-danger">
                                                <div id="sum"></div>
                                            </span>
                                        {% endif %}
                                    <div class="row mb-3 g-3">
                                        <div class="col-md-3">
                                            <label for="id_qty_books_14" class="form-label">Книговыдача (До 14)</label>
                                            {{ form.qty_books_14 }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_30" class="form-label">Книговыдача (15-30)</label>
                                            {{ form.qty_books_30 }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_other" class="form-label">Книговыдача (Прочие)</label>
                                            {{ form.qty_books_other }}
                                        </div>
                                    </div>
                                    {% if mod_lib %}
                                    <h5>В том числе по отраслям</h5>
                                        <hr>
                                    <div class="row mb-3 g-3">
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_opl" class="form-label">Общ.-политтич.лит-ра</label>
                                            {{ form.qty_books_part_opl }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_enm" class="form-label">Естеств. Науки. Медицина</label>
                                            {{ form.qty_books_part_enm }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_tech" class="form-label">Техника</label>
                                            {{ form.qty_books_part_tech }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_sh" class="form-label">Сельское хозяйство</label>
                                            {{ form.qty_books_part_sh }}
                                        </div>
                                    </div>
                                    <div class="row mb-3 g-3">
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_si" class="form-label">Спорт. Искусство</label>
                                            {{ form.qty_books_part_si }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_yl" class="form-label">Языкознание. Лит-ведение</label>
                                            {{ form.qty_books_part_yl }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_hl" class="form-label">Художественная лит-ра</label>
                                            {{ form.qty_books_part_hl }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_dl" class="form-label">Детская литература</label>
                                            {{ form.qty_books_part_dl }}
                                        </div>
                                    </div>
                                    <div class="row mb-3 g-3">
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_other" class="form-label">Прочие(в т.ч. журналы)</label>
                                            {{ form.qty_books_part_other }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_audio" class="form-label">Аудиокниги</label>
                                            {{ form.qty_books_part_audio }}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_qty_books_part_krai" class="form-label">Краеведение(в том числе)</label>
                                            {{ form.qty_books_part_krai }}
                                        </div>
                                    </div>
                                    {% endif %}
                                </fieldset>
                            </div>
                        </div>

                        <!-- Группа справок -->
                        <fieldset class="border border-2 border-info p-4 mb-2">
                            <legend class="text-info">Справки</legend>
                            <div class="row mb-3 g-3">
                                <div class="col-md-3">
                                    <label for="id_qty_books_reference_14" class="form-label">Справки (До 14)</label>
                                    {{ form.qty_books_reference_14 }}
                                </div>
                                <div class="col-md-3">
                                    <label for="id_qty_books_reference_30" class="form-label">Справки (15-30)</label>
                                    {{ form.qty_books_reference_30 }}
                                </div>
                                <div class="col-md-3">
                                    <label for="id_qty_books_reference_other" class="form-label">Справки (Прочие)</label>
                                    {{ form.qty_books_reference_other }}
                                </div>
                                <div class="col-md-3">
                                    <label for="id_qty_books_reference_online" class="form-label">Справки (Удаленно)</label>
                                    {{ form.qty_books_reference_online }}
                                </div>
                            </div>
                        </fieldset>

                        <!-- Примечание -->
                        <div class="col-md-6">
                            <label for="id_note" class="form-label">Примечание</label>
                            {{ form.note }}
                        </div>

                    </div>
                    <div class="modal-footer">
                        <a href="{% url 'child_books_list' %}" class="btn btn-secondary">Закрыть</a>
                        <button type="submit" form="ChildBookReportForm" class="btn btn-primary">Сохранить изменения</button>
                    </div>
                </form>

            </div>
        </div>
      </div>
    </div>
  </div>
<script>
    const qtyBooks14 = document.getElementById('id_qty_books_14');
    const qtyBooks30 = document.getElementById('id_qty_books_30');
    const qtyBooksOther = document.getElementById('qty_books_other');
    const qtyBooksNeb = document.getElementById('id_qty_books_neb');
    const qtyBooksPrlib = document.getElementById('id_qty_books_prlib');

    const qtyBooksPartOpl = document.getElementById('id_qty_books_part_opl');
    const qtyBooksPartEnm = document.getElementById('id_qty_books_part_enm');
    const qtyBooksPartTech = document.getElementById('id_qty_books_part_tech');
    const qtyBooksPartSh = document.getElementById('id_qty_books_part_sh');
    const qtyBooksPartSi = document.getElementById('id_qty_books_part_si');
    const qtyBooksPartYl = document.getElementById('id_qty_books_part_yl');
    const qtyBooksPartHl = document.getElementById('id_qty_books_part_hl');
    const qtyBooksPartDl = document.getElementById('id_qty_books_part_dl');
    const qtyBooksPartOther = document.getElementById('id_qty_books_part_other');
    const qtyBooksPartAudio = document.getElementById('id_qty_books_part_audio');
    const qtyBooksPartKrai = document.getElementById('id_qty_books_part_krai');

    // Получаем элемент для отображения суммы
    const sumElement = document.getElementById('sum');

    // Функция для расчета суммы
    function calculateSum() {
        const sum = parseInt(qtyBooks14.value) + parseInt(qtyBooks30.value) + parseInt(qtyBooksOther.value) + parseInt(qtyBooksNeb.value) + parseInt(qtyBooksPrlib.value);
        const sumPart = parseInt(qtyBooksPartOpl.value) + parseInt(qtyBooksPartEnm.value) + parseInt(qtyBooksPartTech.value) + parseInt(qtyBooksPartSh.value) + parseInt(qtyBooksPartSi.value) + parseInt(qtyBooksPartYl.value) + parseInt(qtyBooksPartHl.value) + parseInt(qtyBooksPartDl.value) + parseInt(qtyBooksPartOther.value) + parseInt(qtyBooksPartAudio.value) + parseInt(qtyBooksPartKrai.value);
        const result = sum - sumPart;
        sumElement.innerText = `Контроль: ${result}`;
    }

    // Добавляем обработчики событий для полей
    qtyBooks14.addEventListener('input', calculateSum);
    qtyBooks30.addEventListener('input', calculateSum);
    qtyBooksOther.addEventListener('input', calculateSum);
    qtyBooksNeb.addEventListener('input', calculateSum);
    qtyBooksPrlib.addEventListener('input', calculateSum);

    qtyBooksPartOpl.addEventListener('input', calculateSum);
    qtyBooksPartEnm.addEventListener('input', calculateSum);
    qtyBooksPartTech.addEventListener('input', calculateSum);
    qtyBooksPartSh.addEventListener('input', calculateSum);
    qtyBooksPartSi.addEventListener('input', calculateSum);
    qtyBooksPartYl.addEventListener('input', calculateSum);
    qtyBooksPartHl.addEventListener('input', calculateSum);
    qtyBooksPartDl.addEventListener('input', calculateSum);
    qtyBooksPartOther.addEventListener('input', calculateSum);
    qtyBooksPartAudio.addEventListener('input', calculateSum);
    qtyBooksPartKrai.addEventListener('input', calculateSum);

    // Вызываем функцию для расчета суммы при загрузке страницы
    calculateSum();
</script>