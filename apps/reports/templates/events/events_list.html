{% extends 'base.html' %}

{% load static %}
{% load sass_tags %}

{% block css %}
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/todo.scss' %}">
<!-- Plugins css Ends-->
{% endblock %}

{% block content %}

<div class="page-body">
      {% include "layout/breadcrumb.html" %}

     {% include "events/components/events_list_form.html" %}

</div>

{% endblock %}

{% block scriptcontent %}
<!-- Plugins JS start-->
    <script src="{% static 'assets/js/todo/todo.js'%}"></script>
    <script src="{% static 'assets/js/todo/todo.js'%}"></script>
    <script src="{% static 'assets/js/chart/apex-chart/apex-chart.js' %}"></script>
    <script>


        // Подготовка данных для графика из контекста Django
        var options = {
            chart: {
                locales: [{
                    "name": "ru",
                    "options": {
                        "months": ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
                        "shortMonths": ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
                        "days": ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота"],
                        "shortDays": ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"],
                        "toolbar": {
                            "exportToSVG": "Экспорт в SVG",
                            "exportToPNG": "Экспорт в PNG",
                            "exportToCSV": "Экспорт в CSV",
                            "menu": "Меню",
                            "selection": "Выбор",
                            "selectionZoom": "Масштабирование выбора",
                            "zoomIn": "Увеличить",
                            "zoomOut": "Уменьшить",
                            "pan": "Перемещение",
                            "reset": "Сброс"
                        }
                    }
                }],
                defaultLocale: 'ru',
                height: 350,
                type: 'line', // Основной тип графика (линейный)
                toolbar: {
                    show: true,
                    tools: {
                        download: true,
                        selection: true,
                        zoom: true,
                        reset: true,
                    },
                    locale: 'ru'  // Устанавливаем язык панели инструментов на русский
                }
            },
            series: [
                {
                    name: 'Количество мероприятий',
                    type: 'column',
                    data: {{ quantity_data|safe }} // Данные по количеству мероприятий за дни (столбцы)
                },
                {
                    name: 'До 14 лет',
                    type: 'column',
                    data: {{ age_14_data|safe }} // Данные по возрасту до 14 лет за дни (столбцы)
                },
                {
                    name: 'До 35 лет',
                    type: 'column',
                    data: {{ age_35_data|safe }} // Данные по возрасту до 35 лет за дни (столбцы)
                },
                {
                    name: 'После 35 лет',
                    type: 'column',
                    data: {{ age_other_data|safe }} // Данные по остальным возрастам за дни (столбцы)
                },
                {
                    name: 'Общее количество участников',
                    type: 'line',
                    data: {{ total_age_data|safe }} // Общее количество участников за дни (линия)
                }
            ],
            xaxis: {
                categories: {{ dates|safe }}, // Даты на оси X (по дням)
            },
        };

        // Инициализация и рендеринг графика
        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    </script>

    <script>
        $(document).on('click', '.edit-event', function() {
            // Получаем данные из кнопки
            var button = $(this);
            var id = button.data('id');
            var cafedra = button.data('cafedra');
            var name = button.data('name');
            var date = button.data('date');
            var direction = button.data('direction');
            var quantity = button.data('quantity');
            var age14 = button.data('age-14');
            var age35 = button.data('age-35');
            var ageOther = button.data('age-other');
            var invalids = button.data('invalids');
            var outOfStation = button.data('out-of-station');
            var asPart = button.data('as-part');
            var paid = button.data('paid') === 'true'; // Проверяем состояние чекбокса
            var note = button.data('note');

            // Заполняем поля формы данными объекта
            $('#id_cafedra').val(cafedra);
            $('#id_name').val(name);
            $('#id_date').val(date);
            $('#id_direction').val(direction);
            $('#id_quantity').val(quantity);
            $('#id_age_14').val(age14);
            $('#id_age_35').val(age35);
            $('#id_age_other').val(ageOther);
            $('#id_invalids').val(invalids);
            $('#id_out_of_station').val(outOfStation);
            $('#id_as_part').val(asPart);

            // Устанавливаем состояние чекбокса
            $('#id_paid').prop('checked', paid); // Устанавливаем состояние чекбокса в соответствии с данными

            // Заполняем поле заметки
            $('#id_note').val(note);

            // Устанавливаем скрытое поле с ID объекта
            $('input[name="pk"]').val(id);

            // Открываем модальное окно
            $('#addEventModal').modal('show');
        });

    </script>

<!-- Plugins JS Ends-->
{% endblock %}